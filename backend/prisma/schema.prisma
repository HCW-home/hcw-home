generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int          @id @default(autoincrement())
  role             Role         @default(Patient) // Enum: Patient, Practitioner, Admin
  firstName        String
  lastName         String
  password         String
  temporaryAccount Boolean
  phoneNumber      String        @unique()
  country          String
  sex              Sex           // Enum: male, female, other
  status           Status         @default(not_approved) // Enum: approved, not_approved
  // Relations
  patientConsultations  Participant[] @relation("PatientConsultations")
  practitionerConsultations Participant[] @relation("PractitionerConsultations")
}

enum Role {
  Patient
  Practitioner
  Admin
}

enum Sex {
  male
  female
  other
}

enum Status {
  approved
  not_approved
}


//  Add the new models/enums that is necessary for consultation remainders

enum MessageService {
  SMS
  EMAIL
  WHATSAPP
  MANUALLY
}

enum ConsultationStatus {
  PENDING
  ACTIVE
  COMPLETED
  CANCELLED
}

enum ParticipantRole {
  PATIENT
  PRACTITIONER
}

model Consultation {
  id                 Int             @id @default(autoincrement())
  uuid               String          @unique @default(uuid())
  status             ConsultationStatus @default(PENDING)
  language           String          @default("en")
  messageService     MessageService
  scheduledDate      DateTime?
  createdAt          DateTime        @default(now())
  startedAt          DateTime?
  closedAt           DateTime?
  magicLink          String?
  introMessage       String?
  templateId         String?         // Reference to Whatsapp_Template
  // Relations
  participants       Participant[]
  patientId          Int?            // For direct reference lookup
  practitionerId     Int?            // For direct reference lookup
}

model Participant {
  id             Int              @id @default(autoincrement())
  consultationId Int
  userId         Int
  role           ParticipantRole
  name           String
  email          String?
  phone          String?
  // Relations
  consultation   Consultation     @relation(fields: [consultationId], references: [id])
  patient        User?            @relation("PatientConsultations", fields: [userId], references: [id], map: "Participant_patientId_fkey")
  practitioner   User?            @relation("PractitionerConsultations", fields: [userId], references: [id], map: "Participant_practitionerId_fkey")

  @@unique([consultationId, userId, role])
}

model Whatsapp_Template {
  id              String  @id
  key             String
  friendlyName    String
  body            String
  language        String
  category        String
  contentType     String
  variables       Json
  actions         Json
  approvalStatus  String
  createdAt       BigInt
  updatedAt       BigInt
  sid             String
  types           Json
  url             String
  rejectionReason String
}

model SMS_Providers {
  id         String @id
  createdAt  BigInt
  updatedAt  BigInt
  order      Int
  provider   String
  prefix     String
  isWhatsapp Boolean
  isDisabled Boolean
}